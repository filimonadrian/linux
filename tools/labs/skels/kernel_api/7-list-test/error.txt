root@qemux86:~# insmod skels/kernel_api/7-list-test/list-test.ko 

============================================
WARNING: possible recursive locking detected
5.10.14+ #2 Tainted: G           O     
--------------------------------------------
insmod/239 is trying to acquire lock:
d085c230 (&lock){+.+.}-{2:2}, at: task_info_add_to_list+0x11/0xb0 [list_sync]

but task is already holding lock:
d085c230 (&lock){+.+.}-{2:2}, at: task_info_add_to_list+0x11/0xb0 [list_sync]

other info that might help us debug this:
 Possible unsafe locking scenario:

       CPU0
       ----
  lock(&lock);
  lock(&lock);

 *** DEADLOCK ***

 May be due to missing lock nesting notation

1 lock held by insmod/239:
 #0: d085c230 (&lock){+.+.}-{2:2}, at: task_info_add_to_list+0x11/0xb0 [list_sync]

stack backtrace:
CPU: 0 PID: 239 Comm: insmod Tainted: G           O      5.10.14+ #2
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.13.0-1ubuntu1.1 04/01/2014
Call Trace:
 dump_stack+0x6d/0x8b
 __lock_acquire.cold+0x12c/0x2db
 ? __free_insn_slot+0x1e0/0x1e0
 ? find_held_lock+0x2a/0x90
 lock_acquire+0xbd/0x340
 ? task_info_add_to_list+0x11/0xb0 [list_sync]
 ? 0xd0847000
 _raw_spin_lock+0x39/0x50
 ? task_info_add_to_list+0x11/0xb0 [list_sync]
 task_info_add_to_list+0x11/0xb0 [list_sync]
 ? 0xd0847000
 task_info_add_for_current+0x38/0x50 [list_sync]
 list_test_init+0x8/0x20 [list_test]
 do_one_initcall+0x57/0x2d0
 ? rcu_read_lock_sched_held+0x47/0x80
 ? kmem_cache_alloc_trace+0x2ed/0x370
 ? do_init_module+0x1f/0x210
 do_init_module+0x4e/0x210
 load_module+0x20a4/0x2580
 ? find_held_lock+0x2a/0x90
 __ia32_sys_init_module+0xed/0x130
 do_int80_syscall_32+0x2c/0x40
 entry_INT80_32+0xf7/0xf7
EIP: 0x44902cc2
Code: 06 89 8a 84 01 00 00 c3 55 57 56 53 8b 6c 24 2c 8b 7c 24 28 8b 74 24 24 8b 54 24 20 8b 4c 24 1c 8b 5c 24 18 8b 44 24 14 cd 80 <5b> 5e 5f 5d 3d 01 f0 ff ff 0f 83 bf 76 f4 ff c3 66 90 66 90 66 90
EAX: ffffffda EBX: 08ba4050 ECX: 0001cb78 EDX: 08ba4008
ESI: 00000000 EDI: bfc9435c EBP: 00000000 ESP: bfc941bc
DS: 007b ES: 007b FS: 0000 GS: 0033 SS: 007b EFLAGS: 00000206
rcu: INFO: rcu_sched detected stalls on CPUs/tasks:
        (detected by 0, t=6502 jiffies, g=7133, q=156)
rcu: All QSes seen, last rcu_sched kthread activity 6502 (-44867--51369), jiffies_till_next_fqs=1, root ->qsmask 0x0
rcu: rcu_sched kthread starved for 6502 jiffies! g7133 f0x2 RCU_GP_WAIT_FQS(5) ->state=0x0 ->cpu=0
rcu:    Unless rcu_sched kthread gets sufficient CPU time, OOM is now expected behavior.
rcu: RCU grace-period kthread stack dump:
task:rcu_sched       state:R  running task     stack:    0 pid:   10 ppid:     2 flags:0x00004000
Call Trace:
 __schedule+0x35f/0x720
 ? _raw_spin_unlock_irqrestore+0x45/0x50
 schedule+0x56/0xd0
 schedule_timeout+0x177/0x2f0
 ? _raw_spin_unlock_irqrestore+0x45/0x50
 ? del_timer_sync+0xc0/0xc0
 rcu_gp_kthread+0x501/0x13c0
 ? lockdep_hardirqs_on_prepare+0xdc/0x1a0
 ? __kthread_parkme+0x5d/0x80
 ? _raw_spin_unlock_irqrestore+0x45/0x50
 ? __kthread_parkme+0x5d/0x80
 ? trace_hardirqs_on+0x2b/0xe0
 kthread+0x103/0x120
 ? rcu_core_si+0x10/0x10
 ? kthread_create_worker_on_cpu+0x20/0x20
 ret_from_fork+0x1c/0x28
rcu: INFO: rcu_sched detected stalls on CPUs/tasks:
        (detected by 0, t=26007 jiffies, g=7133, q=233)
rcu: All QSes seen, last rcu_sched kthread activity 26007 (-25362--51369), jiffies_till_next_fqs=1, root ->qsmask 0x0
rcu: rcu_sched kthread starved for 26007 jiffies! g7133 f0x2 RCU_GP_WAIT_FQS(5) ->state=0x0 ->cpu=0
rcu:    Unless rcu_sched kthread gets sufficient CPU time, OOM is now expected behavior.
rcu: RCU grace-period kthread stack dump:
task:rcu_sched       state:R  running task     stack:    0 pid:   10 ppid:     2 flags:0x00004000
Call Trace:
 __schedule+0x35f/0x720
 ? _raw_spin_unlock_irqrestore+0x45/0x50
 schedule+0x56/0xd0
 schedule_timeout+0x177/0x2f0
 ? _raw_spin_unlock_irqrestore+0x45/0x50
 ? del_timer_sync+0xc0/0xc0
 rcu_gp_kthread+0x501/0x13c0
 ? lockdep_hardirqs_on_prepare+0xdc/0x1a0
 ? __kthread_parkme+0x5d/0x80
 ? _raw_spin_unlock_irqrestore+0x45/0x50
 ? __kthread_parkme+0x5d/0x80
 ? trace_hardirqs_on+0x2b/0xe0
 kthread+0x103/0x120
 ? rcu_core_si+0x10/0x10
 ? kthread_create_worker_on_cpu+0x20/0x20
 ret_from_fork+0x1c/0x28

